"use strict";(globalThis["webpackChunkrecpro"]=globalThis["webpackChunkrecpro"]||[]).push([[558],{8558:(e,l,a)=>{a.r(l),a.d(l,{default:()=>Q});var t=a(9835),o=a(6970),i=a(499),r=a(3746);const u=(0,r.Q_)("record",{state:()=>({data:[]}),actions:{clear(){this.data.splice(0,this.data.length)}}}),s=(0,t.aZ)({__name:"RecordTable",props:{displayAll:{type:Boolean},replayTime:null},setup(e){const l=e,a=16,r=50,s=50,n=16,c=1,d={rowsPerPage:7,rowsPerPageOptions:[7,14,21,48,60]},m=u(),b=(0,t.Fl)((()=>m.data)),v=(0,t.Fl)((()=>{if(l.displayAll){const e=b.value.sort(((e,l)=>e.timestamp-l.timestamp));let a=0;for(let o=0;o<e.length;o++){if(!(e[o].timestamp<=1e3*l.replayTime))break;a=o}const t=[e[a]];for(let l=a-3;l<=a+3;l++)l<a&&l>=0?t.unshift(e[l]):l>a&&l<e.length&&t.push(e[l]);return t.sort(((e,l)=>e.timestamp-l.timestamp))}return b.value})),p=[{name:"timestamp",label:"时间戳",field:"timestamp",width:100,sortable:!0},{name:"x1",label:"X1",field:"x1",width:100,sortable:!1},{name:"y1",label:"Y1",field:"y1",width:100,sortable:!1},{name:"z1",label:"Z1",field:"z1",width:100,sortable:!1},{name:"x2",label:"X2",field:"x2",width:100,sortable:!1},{name:"y2",label:"Y2",field:"y2",width:100,sortable:!1},{name:"z2",label:"Z2",field:"z2",width:100,sortable:!1},{name:"x3",label:"X3",field:"x3",width:100,sortable:!1},{name:"y3",label:"Y3",field:"y3",width:100,sortable:!1},{name:"z3",label:"Z3",field:"z3",width:100,sortable:!1},{name:"x4",label:"X4",field:"x4",width:100,sortable:!1},{name:"y4",label:"Y4",field:"y4",width:100,sortable:!1},{name:"z4",label:"Z4",field:"z4",width:100,sortable:!1},{name:"label",label:"标记",field:"label",width:120,sortable:!1}];return(l,u)=>{const m=(0,t.up)("q-td"),b=(0,t.up)("q-input"),w=(0,t.up)("q-table");return(0,t.wg)(),(0,t.j4)(w,{style:{"flex-grow":"1",width:"100%"},rows:(0,i.SU)(v),columns:p,"row-key":"timestamp",pagination:d,"virtual-scroll-throttle":a,"virtual-scroll-item-size":r,"virtual-scroll-sticky-size":s,"virtual-scroll-render-slice-size":n,"virtual-scroll-render-slice-threshold":c},{"body-cell-timestamp":(0,t.w5)((l=>[(0,t.Wm)(m,{props:l},{default:(0,t.w5)((()=>[(0,t._)("div",{class:(0,o.C_)({active:Math.abs(l.row.timestamp/1e3-e.replayTime)<.15})},(0,o.zw)(l.row.timestamp/1e3),3)])),_:2},1032,["props"])])),"body-cell-label":(0,t.w5)((e=>[(0,t.Wm)(m,{props:e},{default:(0,t.w5)((()=>[(0,t.Wm)(b,{filled:"",dense:"",modelValue:e.row.label,"onUpdate:modelValue":l=>e.row.label=l,maxlength:"1"},null,8,["modelValue","onUpdate:modelValue"])])),_:2},1032,["props"])])),_:1},8,["rows"])}}});var n=a(3508),c=a(7220),d=a(6611),m=a(9984),b=a.n(m);const v=s,p=v;b()(s,"components",{QTable:n.Z,QTd:c.Z,QInput:d.Z});var w=a(9302),y=a(6309),x=a(9290);const h={class:"fullscreen bg-white column",style:{"flex-wrap":"nowrap"}},f={class:"q-gutter-sm q-ma-md flex"},k={class:"flex",style:{position:"relative","flex-grow":"1"}},g={class:"videoPlayer"},z={class:"scene-container"},_={class:"btn-container q-gutter-xs full-width"},$={class:"bg-white text-black q-pa-sm"},W={class:"flex",style:{width:"400px",height:"100%","flex-wrap":"nowrap",position:"relative"}},C=(0,t._)("div",{class:"text-h6"},"导出内容",-1),T=(0,t.aZ)({__name:"Record",setup(e){const l=(0,i.iH)(),a=(0,i.iH)(null),r=(0,i.iH)([]),s=(0,i.iH)(!1),n=(0,i.iH)(),c=(0,i.iH)(0),d=()=>{F.clear(),r.value=[],l.value.srcObject=null,l.value.src="";const e={video:{facingMode:"user"}};navigator.mediaDevices.getUserMedia(e).then((e=>{l.value.srcObject=e,c.value=(new Date).getTime();const t={mimeType:"video/webm;codecs:h.264"};a.value=new MediaRecorder(e,t),a.value.ondataavailable=e=>{e.data.size>0&&r.value.push(e.data)},a.value.start(1e3),s.value=!0}))},m=()=>{a.value?.stop(),l.value.srcObject.getTracks().forEach((e=>e.stop())),l.value.srcObject=null,l.value.src="",s.value=!1},b=(0,i.iH)(!1),v=(0,i.iH)(0),T=(0,i.iH)(.1),Z=(0,i.iH)(!1),U=()=>{const e=new Blob(r.value,{type:"video/mp4"});l.value.src=URL.createObjectURL(e),l.value.play(),l.value.playbackRate=T.value,b.value=!0,l.value.addEventListener("timeupdate",(()=>{v.value=l.value.currentTime})),l.value.addEventListener("ended",(()=>{b.value=!1,l.value.src="end",l.value.onended=null,l.value.ontimeupdate=null}))};(0,t.YP)((()=>T.value),(e=>{l.value.playbackRate=e}));let q={};const F=u(),H=F.data,j=()=>{s.value&&(q.timestamp=(new Date).getTime()-c.value,q.label="",H.push(q)),q={}},V=(e,l,a,t,o)=>{0==t?(q.x1=Number(e.toFixed(4)),q.y1=Number(l.toFixed(4)),q.z1=Number(a.toFixed(4))):1==t?(q.x2=Number(e.toFixed(4)),q.y2=Number(l.toFixed(4)),q.z2=Number(a.toFixed(4))):2==t?(q.x3=Number(e.toFixed(4)),q.y3=Number(l.toFixed(4)),q.z3=Number(a.toFixed(4))):3==t&&(q.x4=Number(e.toFixed(4)),q.y4=Number(l.toFixed(4)),q.z4=Number(a.toFixed(4))),t==o&&j()},N=()=>{const e="x1,y1,z1,x2,y2,z2,x3,y3,z3,x4,y4,z4,label\n",l=H.map((e=>`${e.x1},${e.y1},${e.z1},${e.x2},${e.y2},${e.z2},${e.x3},${e.y3},${e.z3},${e.x4},${e.y4},${e.z4},${e.label}`)).join("\n"),a=new Blob([e+l],{type:"text/csv"}),t=URL.createObjectURL(a),o=document.createElement("a");o.href=t,o.download="data.csv",o.click()},Q=(0,x.o)();(0,t.bv)((()=>{Q.subBallReceiver.set("record",V)})),(0,t.Jd)((()=>{Q.subBallReceiver.delete("record")}));(0,w.Z)();const R=(0,i.iH)(!1),P=(0,i.iH)(""),L=()=>{R.value=!0;const e="x1,y1,z1,x2,y2,z2,x3,y3,z3,x4,y4,z4,label<br />",l=H.map((e=>`${e.x1},${e.y1},${e.z1},${e.x2},${e.y2},${e.z2},${e.x3},${e.y3},${e.z3},${e.x4},${e.y4},${e.z4},${e.label}`)).join("<br />");P.value=e+l};return(e,a)=>{const u=(0,t.up)("q-btn"),c=(0,t.up)("q-input"),w=(0,t.up)("q-checkbox"),x=(0,t.up)("q-space"),q=(0,t.up)("q-card-section"),F=(0,t.up)("q-card-actions"),j=(0,t.up)("q-card"),V=(0,t.up)("q-dialog");return(0,t.wg)(),(0,t.iD)("div",h,[(0,t._)("div",f,[(0,t.Wm)(u,{"text-color":"orange",label:"返回场景",onClick:a[0]||(a[0]=l=>e.$router.push("/"))}),s.value?((0,t.wg)(),(0,t.j4)(u,{key:1,onClick:m},{default:(0,t.w5)((()=>[(0,t.Uk)("停止录制")])),_:1})):((0,t.wg)(),(0,t.j4)(u,{key:0,onClick:d},{default:(0,t.w5)((()=>[(0,t.Uk)("开始录制")])),_:1})),(0,t.Wm)(u,{disabled:0==r.value.length||s.value,onClick:U},{default:(0,t.w5)((()=>[(0,t.Uk)(" 回放录制 ")])),_:1},8,["disabled"]),(0,t.Wm)(c,{filled:"",dense:"",modelValue:T.value,"onUpdate:modelValue":a[1]||(a[1]=e=>T.value=e),label:"播放倍速",style:{width:"120px"}},null,8,["modelValue"]),(0,t.Wm)(w,{modelValue:Z.value,"onUpdate:modelValue":a[2]||(a[2]=e=>Z.value=e),label:"展示所有数据"},null,8,["modelValue"]),(0,t.Wm)(u,{onClick:L},{default:(0,t.w5)((()=>[(0,t.Uk)("导出文本")])),_:1})]),(0,t._)("div",k,[(0,t._)("div",g,[(0,t._)("div",z,[(0,t.Wm)(y.Z,{ref_key:"scene",ref:n},null,512)]),(0,t._)("div",_,[(0,t.Wm)(u,{color:"white","text-color":"black",label:"向后0.5",onClick:a[3]||(a[3]=e=>l.value.currentTime-=.5)}),(0,t.Wm)(u,{color:"white","text-color":"black",label:"向后0.2",onClick:a[4]||(a[4]=e=>l.value.currentTime-=.2)}),(0,t.Wm)(u,{color:"white","text-color":"black",label:"向后0.1",onClick:a[5]||(a[5]=e=>l.value.currentTime-=.1)}),b.value?((0,t.wg)(),(0,t.j4)(u,{key:1,color:"white","text-color":"black",label:"暂停",onClick:a[7]||(a[7]=e=>(l.value.pause(),b.value=!1))})):((0,t.wg)(),(0,t.j4)(u,{key:0,color:"white","text-color":"black",label:"播放",onClick:a[6]||(a[6]=e=>(l.value.play(),b.value=!0))})),(0,t.Wm)(u,{color:"white","text-color":"black",label:"向前0.1",onClick:a[8]||(a[8]=e=>l.value.currentTime+=.1)}),(0,t.Wm)(u,{color:"white","text-color":"black",label:"向前0.2",onClick:a[9]||(a[9]=e=>l.value.currentTime+=.2)}),(0,t.Wm)(u,{color:"white","text-color":"black",label:"向前0.5",onClick:a[10]||(a[10]=e=>l.value.currentTime+=.5)}),(0,t.Wm)(x),(0,t._)("div",$," 时间 "+(0,o.zw)(l.value?.currentTime),1)]),(0,t._)("video",{ref_key:"videoPlayer",ref:l,class:"full-width full-height",autoplay:"",controls:"",onPause:a[11]||(a[11]=e=>b.value=!1),onPlay:a[12]||(a[12]=e=>b.value=!s.value)},null,544)]),(0,t._)("div",W,[(0,t.Wm)(p,{data:(0,i.SU)(H),"display-all":Z.value,"replay-time":v.value},null,8,["data","display-all","replay-time"])])]),(0,t.Wm)(V,{modelValue:R.value,"onUpdate:modelValue":a[14]||(a[14]=e=>R.value=e)},{default:(0,t.w5)((()=>[(0,t.Wm)(j,null,{default:(0,t.w5)((()=>[(0,t.Wm)(q,null,{default:(0,t.w5)((()=>[C])),_:1}),(0,t.Wm)(q,{innerHTML:P.value},null,8,["innerHTML"]),(0,t.Wm)(F,{align:"right",class:"bg-white",style:{position:"sticky",bottom:"0"}},{default:(0,t.w5)((()=>[(0,t.Wm)(u,{flat:"",label:"下载",color:"primary",onClick:N}),(0,t.Wm)(u,{flat:"",label:"关闭",color:"primary",onClick:a[13]||(a[13]=e=>R.value=!1)})])),_:1})])),_:1})])),_:1},8,["modelValue"])])}}});var Z=a(4455),U=a(1221),q=a(136),F=a(2074),H=a(4458),j=a(3190),V=a(1821);const N=T,Q=N;b()(T,"components",{QBtn:Z.Z,QInput:d.Z,QCheckbox:U.Z,QSpace:q.Z,QDialog:F.Z,QCard:H.Z,QCardSection:j.Z,QCardActions:V.Z})}}]);